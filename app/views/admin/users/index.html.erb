
<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "application", media: "all" %>
<% end %>
<div class="search-card">
        <h4 class="mb-3" style="color: var(--text-secondary); font-size: 1.1rem;">üîç Filtrar Usuarios</h4>
        
        <%= form_with url: admin_users_path, method: :get, class: "row g-3 align-items-end" do |f| %>
            
            <div class="col-12 col-md-3">
                <label class="form-label small fw-bold text-muted">Nombre</label>
                <%= f.text_field :name, placeholder: "Ej. Juan", value: params[:name], class: "form-control search-input" %>
            </div>
            
            <div class="col-12 col-md-3">
                <label class="form-label small fw-bold text-muted">Apellido</label>
                <%= f.text_field :lastname, placeholder: "Ej. P√©rez", value: params[:lastname], class: "form-control search-input" %>
            </div>

            <div class="col-12 col-md-3">
                <label class="form-label small fw-bold text-muted">Email</label>
                <%= f.text_field :email, placeholder: "usuario@email.com", value: params[:email], class: "form-control search-input" %>
            </div>

            <div class="col-12 col-md-2">
                <label class="form-label small fw-bold text-muted">Rol</label>
                <%= select_tag :role, 
                    options_for_select(['Admin', 'Manager', 'Employee'], params[:role]), 
                    class: "form-select search-input", 
                    prompt: "Cualquier Rol" 
                %>
            </div>

            
            
            <div class="col-12 col-md-3">
                <div class="d-flex gap-2">
                    <%= f.submit "Buscar", class: "btn btn-search w-100" %>
                    <% if params[:name].present? || params[:lastname].present? || params[:email].present? || params[:role].present? %>
                        <%= link_to "Limpiar", admin_users_path, class: "btn btn-outline-secondary" %>
                    <% end %>
                </div>
            </div>

        <% end %>
    </div>
<div class="users-container">
    <div class="users-grid">
        
        <% @users.each do |user| %>

            <% if can? :update, user %>

                <%= link_to admin_user_path(user), class: "user-card" do %>

                    <div class="user-avatar">
                        <%= user.name.first.upcase + user.lastname.first.upcase %>
                    </div>

                    <div class="user-info">
                        <h3 class="user-name"><%= user.name + (user == current_user ? " (t√∫)" : "") %></h3>
                        <p class="user-apellido"><%= user.lastname %></p>
                        <p class="user-username"><%= user.email %></p>
                        <span class="user-role"><%= user.role %></span>
                    </div>
                    <% if can?(:delete, user) && user.id != current_user.id %>
                        <% if user.is_active %>
                            <%= button_to "Eliminar Usuario",
                                admin_user_path(user),
                                method: :delete,
                                class: "btn-user-action btn-delete" %>
                        <% else %>
                            <%= button_to "Reactivar Usuario",
                                reactivate_admin_user_path(user),
                                method: :patch,
                                class: "btn-user-action btn-reactivate" %>
                        <% end %>
                    <% end %>

                <% end %> <!-- cierre del link_to -->

            <% else %>

                <div class="user-card user-card-disabled">

                    <div class="user-avatar">
                        <%= user.name.first.upcase + user.lastname.first.upcase %>
                    </div>

                    <div class="user-info">
                        <h3 class="user-name"><%= user.name %></h3>
                        <p class="user-apellido"><%= user.lastname %></p>
                        <p class="user-username"><%= user.email %></p>
                        <span class="user-role"><%= user.role %></span>
                    </div>

                    <% if can?(:delete, user) && user.id != current_user.id %>
                        <% if user.is_active %>
                            <%= button_to "Eliminar Usuario",
                                admin_user_path(user),
                                method: :delete,
                                class: "btn-user-action btn-delete" %>
                        <% else %>
                            <%= button_to "Reactivar Usuario",
                                reactivate_admin_user_path(user),
                                method: :patch,
                                class: "btn-user-action btn-reactivate" %>
                        <% end %>
                    <% end %>

                </div>

            <% end %>

        <% end %>
    </div>
</div>

<div class="create-user-button-container">
    <% if can? :create, User %>
        <%= button_to "Crear Usuario", new_admin_user_path, method: :get, class: "btn" %>
    <% end %>
</div>

<%= paginate @users %>



