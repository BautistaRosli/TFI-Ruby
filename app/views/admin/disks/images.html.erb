<% content_for :stylesheets do %>
  <%= stylesheet_link_tag 'disks', media: 'all' %>
<% end %>

<div class="container" style="max-width:980px; margin:24px auto;">
  <div class="disks-header">
    <h2>Imágenes de <%= @disk.name %></h2>
    <div class="disks-actions">
      <%= link_to 'Volver al disco', admin_disk_path(@disk), class: 'btn-outline' %>
    </div>
  </div>

  <div class="module-card" style="padding:1.5rem;">
    <h3 style="margin-bottom:10px;">Subir imagen (una por vez)</h3>
    <%= form_with url: add_image_admin_disk_path(@disk), method: :post, local: true, html: { multipart: true } do %>
      <div style="display:flex; gap:10px; align-items:center;">
        <input type="file" name="image" accept="image/*" class="form-control" />
        <%= submit_tag 'Agregar', class: 'btn-primary' %>
      </div>
      <p class="muted" style="margin-top:8px;">Máximo 10 imágenes. La portada es una de estas imágenes.</p>
    <% end %>
  </div>

  <div class="module-card" style="padding:1.5rem; margin-top:16px;">
    <h3 style="margin-bottom:10px;">Previsualización</h3>
    <% if @disk.images.attached? && @disk.images.any? %>
      <% cover_blob_id = @disk.cover&.attached? ? @disk.cover.blob_id : nil %>
      <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:12px;">
        <% @disk.images.each do |img| %>
          <div style="position:relative; border:1px solid #e2e8f0; border-radius:8px; padding:8px;">
            <%= image_tag img, alt: 'preview', style: 'width:100%; border-radius:6px;' %>
            <% if cover_blob_id.present? && cover_blob_id == img.blob_id %>
              <span class="disk-date" style="position:absolute; top:8px; left:8px;">Portada</span>
            <% end %>
            <div style="display:flex; gap:8px; margin-top:8px;">
              <%= button_to 'Eliminar', remove_image_admin_disk_path(@disk, id: img.id), method: :delete, class: 'btn-outline', form: { data: { turbo: false } } %>
              <%= button_to 'Hacer portada', set_cover_admin_disk_path(@disk, cover_image_id: img.id), method: :patch, class: 'btn-primary', form: { data: { turbo: false } } %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="muted">Aún no hay imágenes cargadas.</p>
    <% end %>
  </div>
</div>