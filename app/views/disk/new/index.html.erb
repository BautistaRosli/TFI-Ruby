<div class="container">
  <div class="disks-hero">
    <div>
      <h1>Catálogo de Discos Nuevos</h1>
      <p class="muted">Explora nuestras últimas incorporaciones</p>
    </div>
  </div>

  <div class="filters-bar">
    <%= stylesheet_link_tag "disks_index", media: "all" %>
    <%= form_with url: disk_new_index_path, method: :get, local: true, class: "filters-form" do |f| %>
      <div class="filter-group">
        <%= f.text_field :name, placeholder: "Buscar por nombre...", value: params[:name], class: "filter-input" %>
      </div>
      
      <div class="filter-group">
        <%= f.text_field :author, placeholder: "Buscar por autor...", value: params[:author], class: "filter-input" %>
      </div>
      
      <div class="filter-group">
        <%= f.select :genre_id, 
            options_for_select([["Todos los géneros", ""]] + @genres.map { |g| [g.name, g.id] }, params[:genre_id]),
            { include_blank: false },
            class: "filter-select" %>
      </div>

      <div class="filter-group">
        <%= f.number_field :min_price, placeholder: "Precio mín...", value: params[:min_price], class: "filter-input", min: 0 %>
      </div>

      <div class="filter-group">
        <%= f.number_field :max_price, placeholder: "Precio máx...", value: params[:max_price], class: "filter-input", min: 0 %>
      </div>

      <div class="filter-group">
        <%= f.number_field :min_year, placeholder: "Año mín...", value: params[:min_year], class: "filter-input", min: 1900 %>
      </div>

      <div class="filter-group">
        <%= f.number_field :max_year, placeholder: "Año máx...", value: params[:max_year], class: "filter-input", min: 1900, max: Time.now.year %>
      </div>
      
      <div class="filter-group">
        <%= link_to "Limpiar", disk_new_index_path, class: "btn-filter" %>
        <%= f.submit "Buscar", class: "btn-filter-clear" %>
      </div>
    <% end %>
  </div>
  

  <div class="disks-grid">
    <% if @disks.any? %>
      <% @disks.each do |disk| %>
        <div class="disk-card">
          <%= link_to disk_new_path(disk), class: "card-link" do %>
            <div class="disk-media">
              <div class="card-carousel" data-disk-id="<%= disk.id %>">
                <button type="button" class="carousel-btn prev" aria-label="Anterior">‹</button>
                <div class="carousel-track">
                  <% if disk.cover.attached? %>
                    <div class="carousel-slide">
                      <%= image_tag disk.cover, alt: disk.name %>
                    </div>
                  <% end %>

                  <% if disk.images.attached? %>
                    <% disk.images.each do |img| %>
                      <div class="carousel-slide">
                        <%= image_tag img, alt: disk.name %>
                      </div>
                    <% end %>
                  <% end %>

                  <% if !disk.cover.attached? && !disk.images.attached? %>
                    <div class="carousel-slide">
                      <div class="cover-placeholder" role="img" aria-label="Disco sin portada">Disco sin portada</div>
                    </div>
                  <% end %>
                </div>
                <button type="button" class="carousel-btn next" aria-label="Siguiente">›</button>
              </div>
            </div>

            <div class="disk-body">
              <h3 class="disk-title"><%= disk.name %></h3>
              <div class="disk-meta">
                <%= disk.author %>
                <% if disk.date_ingreso.present? %>
                  <span class="disk-year"> · <%= disk.date_ingreso.year %></span>
                <% end %>
              </div>
              <% if disk.genres.any? %>
                <div class="tags">
                  <% disk.genres.each do |g| %>
                    <span class="tag"><%= g.name + ", "%></span>
                  <% end %>
                </div>
              <% end %>
            </div>

            <div class="disk-footer">
              <div class="price">$<%= disk.unit_price %></div>
              <div class="actions">
                <%= link_to 'Ver detalles', disk_new_path(disk), class: 'btn-primary' %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <p class="no-results">No se encontraron discos con esos criterios de búsqueda.</p>
    <% end %>
  </div>
  <div class="pagination-wrap">
    <%= paginate @disks %>
  </div>
</div>
