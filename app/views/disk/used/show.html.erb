<div class="container">
  <div class="disk-show-card">
    <div class="disk-show-info">
      <h1 class="disk-show-title"><%= @disk.name %></h1>

      <ul class="disk-details">
        <li><strong>Artista:</strong> <span class="muted"><%= @disk.author %></span></li>
        <li><strong>Año:</strong> <span class="muted"><%= @disk.year if @disk.respond_to?(:year) %></span></li>
        <li><strong>Formato:</strong> <span class="muted"><%= @disk.format %></span></li>
        <li><strong>Precio:</strong> <span class="price">$<%= @disk.unit_price %></span></li>
        <% if @disk.genres.any? %>
          <li>
            <strong>Géneros:</strong>
            <span class="muted">
              <% @disk.genres.each do |g| %>
                <span class="tag"><%= g.name %></span>
              <% end %>
            </span>
          </li>
        <% end %>
      </ul>

      <div class="disk-description">
        <h2>Descripción</h2>
        <div class="description-body">
          <%= simple_format(@disk.description || 'Sin descripción disponible') %>
        </div>
      </div>

      <div class="disk-audio">
        <h3>Audio de muestra</h3>
        <audio id="sample-audio" preload="none">
          <source src="<%= (@disk.respond_to?(:audio) && @disk.audio.attached?) ? url_for(@disk.audio) : '/samsung-sound.mp3' %>"
                  type="<%= (@disk.respond_to?(:audio) && @disk.audio.attached?) ? @disk.audio.blob.content_type : 'audio/mpeg' %>">
          Tu navegador no soporta audio.
        </audio>
        <div style="margin-top:10px">
          <button id="play-sample" type="button" class="btn-primary">Reproducir audio</button>
        </div>
      </div>

      <div class="disk-actions">
        <%= link_to 'Volver al catálogo', disk_used_index_path, class: 'btn-outline btn-gold' %>
      </div>
    </div>

    <div class="disk-show-media">
      <% if @disk.cover.present? %>
        <%= image_tag @disk.cover, alt: @disk.name, class: 'disk-large-img' %>
      <% else %>
        <%= image_tag '/tony/tony2.png', alt: 'Portada provisional', class: 'disk-large-img' %>
      <% end %>
    </div>
  </div>
</div>

<script>
  (function(){
    function setup(){
      var btn = document.getElementById('play-sample');
      var audio = document.getElementById('sample-audio');
      if(!btn || !audio) return;
      btn.addEventListener('click', function(){
        if(audio.paused){
          audio.play();
          btn.textContent = 'Pausar audio';
        } else {
          audio.pause();
          btn.textContent = 'Reproducir audio';
        }
      });
      audio.addEventListener('ended', function(){ btn.textContent = 'Reproducir audio'; });
    }
    document.addEventListener('DOMContentLoaded', setup);
    document.addEventListener('turbo:load', setup);
  })();
</script>
